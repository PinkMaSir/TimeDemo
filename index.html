
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡æ—¶é—´è®¡ç®—å™¨</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            background-color: #f9fafb;
            color: #1e293b;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body.dark-mode {
            background-color: #111827;
            color: #f3f4f6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        header {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 50;
            transition: padding 0.3s;
            padding: 1rem 0;
        }
        
        header.dark-mode {
            background-color: #1f2937;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3b82f6;
        }
        
        .nav-links {
            display: flex;
            gap: 1.5rem;
        }
        
        .nav-link {
            color: #4b5563;
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .dark-mode .nav-link {
            color: #d1d5db;
        }
        
        .nav-link:hover {
            color: #3b82f6;
        }
        
        .btn {
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 0.375rem;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .btn:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary {
            background-color: #10b981;
        }
        
        .btn-secondary:hover {
            background-color: #059669;
        }
        
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #4b5563;
        }
        
        .dark-mode .mobile-menu-btn {
            color: #d1d5db;
        }
        
        /* ä¸»å†…å®¹åŒºæ ·å¼ */
        main {
            padding: 2rem 0;
        }
        
        .card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .dark-mode .card {
            background-color: #1f2937;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1e293b;
        }
        
        .dark-mode .card-title {
            color: #f3f4f6;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
            background-color: white;
            color: #1e293b;
        }
        
        .dark-mode input, 
        .dark-mode textarea, 
        .dark-mode select {
            background-color: #374151;
            border-color: #4b5563;
            color: #f3f4f6;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.25);
        }
        
        .form-actions {
            margin-top: 1.5rem;
            display: flex;
            gap: 1rem;
        }
        
        /* ç»“æœåŒºåŸŸæ ·å¼ */
        .results-container {
            display: none;
        }
        
        .no-results, .error-message {
            padding: 1rem;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
        }
        
        .no-results {
            background-color: #f3f4f6;
            color: #4b5563;
        }
        
        .dark-mode .no-results {
            background-color: #374151;
            color: #d1d5db;
        }
        
        .error-message {
            background-color: #fee2e2;
            color: #dc2626;
            display: none;
        }
        
        .dark-mode .error-message {
            background-color: #450a0a;
        }
        
        .query-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .dark-mode .query-section {
            border-top-color: #374151;
        }
        
        .query-group {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .query-result {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #eff6ff;
            border-radius: 0.375rem;
            display: none;
        }
        
        .dark-mode .query-result {
            background-color: #1e3a8a;
        }
        
        .query-error {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #fee2e2;
            color: #dc2626;
            border-radius: 0.375rem;
            display: none;
        }
        
        .dark-mode .query-error {
            background-color: #450a0a;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        .table-container {
            overflow-x: auto;
            margin-bottom: 1.5rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .dark-mode th, 
        .dark-mode td {
            border-bottom-color: #374151;
        }
        
        th {
            font-weight: 600;
            background-color: #f8fafc;
        }
        
        .dark-mode th {
            background-color: #1f2937;
        }
        
        tr:nth-child(even) {
            background-color: #f8fafc;
        }
        
        .dark-mode tr:nth-child(even) {
            background-color: #374151;
        }
        
        .text-primary {
            color: #3b82f6;
        }
        
        /* å›¾è¡¨æ ·å¼ */
        .chart-container {
            width: 100%;
            height: 400px;
            margin-top: 1.5rem;
        }
        
        svg {
            width: 100%;
            height: 100%;
        }
        
        .chart-grid {
            stroke: #e5e7eb;
            stroke-width: 1;
        }
        
        .dark-mode .chart-grid {
            stroke: #374151;
        }
        
        .chart-line {
            stroke: #3b82f6;
            stroke-width: 2;
            fill: none;
        }
        
        .chart-area {
            fill: rgba(59, 130, 246, 0.1);
        }
        
        .chart-point {
            fill: #3b82f6;
        }
        
        .chart-axis {
            stroke: #9ca3af;
            stroke-width: 1;
        }
        
        .dark-mode .chart-axis {
            stroke: #6b7280;
        }
        
        .chart-label {
            font-size: 12px;
            fill: #6b7280;
            text-anchor: middle;
        }
        
        .dark-mode .chart-label {
            fill: #d1d5db;
        }
        
        .chart-title {
            font-size: 14px;
            font-weight: 600;
            fill: #1f2937;
        }
        
        .dark-mode .chart-title {
            fill: #f3f4f6;
        }
        
        /* å¸®åŠ©æ¨¡æ€æ¡† */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .modal {
            background-color: white;
            border-radius: 0.5rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            padding: 1.5rem;
        }
        
        .dark-mode .modal {
            background-color: #1f2937;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .modal-content p {
            margin-bottom: 1rem;
        }
        
        .modal-close {
            margin-top: 1rem;
            text-align: right;
        }
        
        /* é¡µè„šæ ·å¼ */
        footer {
            background-color: white;
            border-top: 1px solid #e5e7eb;
            padding: 2rem 0;
            margin-top: 2rem;
        }
        
        .dark-mode footer {
            background-color: #1f2937;
            border-top-color: #374151;
        }
        
        .footer-content {
            text-align: center;
            color: #6b7280;
        }
        
        .dark-mode .footer-content {
            color: #9ca3af;
        }
        
        /* ç§»åŠ¨ç«¯æ ·å¼ */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background-color: white;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                padding: 1rem;
                gap: 0.5rem;
            }
            
            .dark-mode .nav-links {
                background-color: #1f2937;
            }
            
            .nav-links.show {
                display: flex;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .query-group {
                flex-direction: column;
                align-items: stretch;
            }
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        .animate-pulse {
            animation: pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
    </style>
</head>
<body>
    <header id="header">
        <div class="container header-content">
            <div class="logo">å‡æ—¶é—´è®¡ç®—å™¨</div>
            <button id="mobileMenuBtn" class="mobile-menu-btn">
                â˜°
            </button>
            <nav class="nav-links" id="mobileMenu">
                <a href="#" class="nav-link" id="helpBtn">å¸®åŠ©</a>
                <button class="nav-link" id="themeToggle">
                    <span id="themeIcon">ğŸŒ™</span>
                </button>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2 class="card-title">è¾“å…¥å‚æ•°</h2>
            <form id="calculatorForm">
                <div class="form-group">
                    <label for="timePoints">æ—¶é—´ç‚¹ (å°æ—¶)ï¼Œç”¨ç©ºæ ¼åˆ†éš”</label>
                    <textarea id="timePoints" rows="3" placeholder="ä¾‹å¦‚: 0 0.25 0.5 ..."></textarea>
                </div>
                <div class="form-group">
                    <label for="gasViscosity">æ°”ä½“ç²˜åº¦ (mPaÂ·s)ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼Œä¸æ—¶é—´ç‚¹ä¸€ä¸€å¯¹åº”</label>
                    <textarea id="gasViscosity" rows="3" placeholder="ä¾‹å¦‚: 0.0144 0.01536 0.01596 ..."></textarea>
                </div>
                <div class="form-group">
                    <label for="compressibility">å‹ç¼©ç³»æ•° (MPaâ»Â¹)ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼Œä¸æ—¶é—´ç‚¹ä¸€ä¸€å¯¹åº”</label>
                    <textarea id="compressibility" rows="3" placeholder="ä¾‹å¦‚: 0.1244 0.0991 0.08657 ..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn">è®¡ç®—å‡æ—¶é—´</button>
                    <button type="button" class="btn btn-secondary" id="loadExampleBtn">åŠ è½½ç¤ºä¾‹æ•°æ®</button>
                </div>
            </form>
        </div>

        <div id="noResultsMessage" class="no-results">
            è¯·è¾“å…¥æ•°æ®å¹¶ç‚¹å‡»"è®¡ç®—å‡æ—¶é—´"æŒ‰é’®
        </div>

        <div id="errorMessage" class="error-message">
            <span id="errorText"></span>
        </div>

        <div id="resultsContainer" class="results-container">
            <div class="card">
                <h2 class="card-title">è®¡ç®—ç»“æœ</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>æ—¶é—´ t (h)</th>
                                <th>æ—¶é—´é—´éš” dt (h)</th>
                                <th>æ—¶é—´é—´éš” dt (s)</th>
                                <th>A = 1/(Î¼Â·C)</th>
                                <th>Bå€¼</th>
                                <th>C'å€¼</th>
                                <th>å‡æ—¶é—´ tâ‚</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTableBody">
                            <!-- ç»“æœå°†åœ¨è¿™é‡ŒåŠ¨æ€å¡«å…… -->
                        </tbody>
                    </table>
                </div>

                <div class="chart-container">
                    <svg id="timeChart"></svg>
                </div>

                <div class="query-section">
                    <h3 class="card-title">æŸ¥è¯¢ç‰¹å®šæ—¶é—´çš„å‡æ—¶é—´</h3>
                    <div class="query-group">
                        <div class="form-group" style="flex: 1;">
                            <label for="queryTime">è¾“å…¥æ—¶é—´ (å°æ—¶)</label>
                            <input type="number" id="queryTime" step="0.01" disabled>
                        </div>
                        <button id="queryButton" class="btn" style="flex-shrink: 0;" disabled>æŸ¥è¯¢</button>
                    </div>
                    <div id="queryResult" class="query-result">
                        <span id="queryResultText"></span>
                    </div>
                    <div id="queryError" class="query-error">
                        <span id="queryErrorText"></span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container footer-content">
            <p>å‡æ—¶é—´è®¡ç®—å™¨ &copy; 2023 - ç¦»çº¿ç‰ˆ</p>
        </div>
    </footer>

    <!-- å¸®åŠ©æ¨¡æ€æ¡† -->
    <div id="helpModal" class="modal-overlay">
        <div class="modal">
            <h3 class="modal-title">ä½¿ç”¨å¸®åŠ©</h3>
            <div class="modal-content">
                <p>å‡æ—¶é—´è®¡ç®—å™¨ç”¨äºè®¡ç®—æ²¹æ°”è—å·¥ç¨‹ä¸­çš„å‡æ—¶é—´å‚æ•°ï¼ŒåŸºäºä»¥ä¸‹å…¬å¼ï¼š</p>
                <p>1. è®¡ç®— A = 1/(Î¼â‚‰Â·Câ‚œ)</p>
                <p>2. è®¡ç®—æ—¶é—´é—´éš”å¹¶è½¬æ¢ä¸ºç§’</p>
                <p>3. è®¡ç®— B å€¼ï¼ˆA å€¼çš„å¹³å‡å€¼ï¼‰</p>
                <p>4. è®¡ç®— C' å€¼ = BÂ·Î”t(ç§’)</p>
                <p>5. å‡æ—¶é—´ tâ‚ ä¸º C' å€¼çš„ç´¯ç§¯å’Œ</p>
                <p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
                <p>1. è¾“å…¥æ—¶é—´ç‚¹ã€æ°”ä½“ç²˜åº¦å’Œå‹ç¼©ç³»æ•°ï¼Œç”¨ç©ºæ ¼åˆ†éš”</p>
                <p>2. ç‚¹å‡»"è®¡ç®—å‡æ—¶é—´"æŒ‰é’®</p>
                <p>3. æŸ¥çœ‹è®¡ç®—ç»“æœè¡¨æ ¼å’Œå›¾è¡¨</p>
                <p>4. å¯åœ¨ç»“æœåŒºåŸŸæŸ¥è¯¢ç‰¹å®šæ—¶é—´ç‚¹çš„å‡æ—¶é—´</p>
            </div>
            <div class="modal-close">
                <button id="closeHelpBtn" class="btn">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        // ç¤ºä¾‹æ•°æ®
        const exampleData = {
            timePoints: [0, 0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2, 2.25, 2.5, 2.75, 3],
            gasViscosity: [0.0144, 0.01536, 0.01596, 0.01647, 0.01689, 0.01726, 0.01755, 0.01778, 0.01802, 0.01825, 0.01843, 0.01859, 0.01872],
            compressibility: [0.1244, 0.0991, 0.08657, 0.07756, 0.072, 0.0675, 0.06431, 0.06189, 0.05943, 0.05724, 0.05557, 0.05412, 0.05302]
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            // åŠ è½½ç¤ºä¾‹æ•°æ®æŒ‰é’®äº‹ä»¶
            document.getElementById('loadExampleBtn').addEventListener('click', () => {
                document.getElementById('timePoints').value = exampleData.timePoints.join(' ');
                document.getElementById('gasViscosity').value = exampleData.gasViscosity.join(' ');
                document.getElementById('compressibility').value = exampleData.compressibility.join(' ');
            });
        });

        // å…¨å±€å˜é‡
        let calculationResults = null;
        
        // DOMå…ƒç´ 
        const form = document.getElementById('calculatorForm');
        const resultsContainer = document.getElementById('resultsContainer');
        const noResultsMessage = document.getElementById('noResultsMessage');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const resultsTableBody = document.getElementById('resultsTableBody');
        const queryTimeInput = document.getElementById('queryTime');
        const queryButton = document.getElementById('queryButton');
        const queryResult = document.getElementById('queryResult');
        const queryResultText = document.getElementById('queryResultText');
        const queryError = document.getElementById('queryError');
        const queryErrorText = document.getElementById('queryErrorText');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        const helpBtn = document.getElementById('helpBtn');
        const helpModal = document.getElementById('helpModal');
        const closeHelpBtn = document.getElementById('closeHelpBtn');
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const header = document.getElementById('header');
        const loadExampleBtn = document.getElementById('loadExampleBtn');
        
        // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('show');
        });
        
        // å¸®åŠ©æ¨¡æ€æ¡†æ§åˆ¶
        function openHelpModal() {
            helpModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function closeHelpModal() {
            helpModal.style.display = 'none';
            document.body.style.overflow = '';
        }
        
        helpBtn.addEventListener('click', openHelpModal);
        closeHelpBtn.addEventListener('click', closeHelpModal);
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        helpModal.addEventListener('click', (e) => {
            if (e.target === helpModal) {
                closeHelpModal();
            }
        });
        
        // ä¸»é¢˜åˆ‡æ¢
        themeToggle.addEventListener('click', toggleTheme);
        
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            header.classList.toggle('dark-mode');
            
            const isDark = document.body.classList.contains('dark-mode');
            
            if (isDark) {
                themeIcon.textContent = 'â˜€ï¸';
            } else {
                themeIcon.textContent = 'ğŸŒ™';
            }
            
            // å¦‚æœå›¾è¡¨å·²å­˜åœ¨ï¼Œæ›´æ–°ä¸»é¢˜
            if (calculationResults) {
                createChart(calculationResults.t, calculationResults.t_a);
            }
        }
        
        // è¡¨å•æäº¤å¤„ç†
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            calculatePseudoTime();
        });
        
        // æŸ¥è¯¢æŒ‰é’®ç‚¹å‡»å¤„ç†
        queryButton.addEventListener('click', () => {
            queryPseudoTime();
        });
        
        // æŒ‰Enteré”®æŸ¥è¯¢
        queryTimeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                queryPseudoTime();
            }
        });
        
        // å‡æ—¶é—´è®¡ç®—å‡½æ•°
        function calculatePseudoTime() {
            // è·å–è¾“å…¥å€¼
            const timePointsStr = document.getElementById('timePoints').value.trim();
            const gasViscosityStr = document.getElementById('gasViscosity').value.trim();
            const compressibilityStr = document.getElementById('compressibility').value.trim();
            
            // è§£æè¾“å…¥ä¸ºæ•°ç»„
            try {
                const t = timePointsStr.split(/\s+/).map(Number);
                const mu_g = gasViscosityStr.split(/\s+/).map(Number);
                const C_t = compressibilityStr.split(/\s+/).map(Number);
                
                // éªŒè¯è¾“å…¥
                if (t.length === 0 || mu_g.length === 0 || C_t.length === 0) {
                    showError('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å€¼');
                    return;
                }
                
                if (!(t.length === mu_g.length && mu_g.length === C_t.length)) {
                    showError('æ—¶é—´ç‚¹ã€ç²˜åº¦å’Œå‹ç¼©ç³»æ•°çš„æ•°å€¼æ•°é‡å¿…é¡»ç›¸åŒ');
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦æœ‰éæ•°å€¼
                if (t.some(isNaN) || mu_g.some(isNaN) || C_t.some(isNaN)) {
                    showError('è¾“å…¥åŒ…å«éæ•°å€¼ï¼Œè¯·æ£€æŸ¥');
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦æœ‰è´Ÿå€¼
                if (t.some(v => v < 0) || mu_g.some(v => v <= 0) || C_t.some(v => v <= 0)) {
                    showError('æ—¶é—´ç‚¹ä¸èƒ½ä¸ºè´Ÿï¼Œç²˜åº¦å’Œå‹ç¼©ç³»æ•°å¿…é¡»ä¸ºæ­£æ•°');
                    return;
                }
                
                // æ£€æŸ¥æ—¶é—´ç‚¹æ˜¯å¦é€’å¢
                for (let i = 1; i < t.length; i++) {
                    if (t[i] <= t[i-1]) {
                        showError('æ—¶é—´ç‚¹å¿…é¡»æŒ‰é€’å¢é¡ºåºè¾“å…¥');
                        return;
                    }
                }
                
                // æ‰§è¡Œè®¡ç®—
                const results = performCalculation(t, mu_g, C_t);
                
                // å­˜å‚¨è®¡ç®—ç»“æœ
                calculationResults = results;
                
                // æ˜¾ç¤ºç»“æœ
                displayResults(results);
                
                // å¯ç”¨æŸ¥è¯¢åŠŸèƒ½
                queryTimeInput.disabled = false;
                queryButton.disabled = false;
                queryTimeInput.focus();
                
            } catch (error) {
                showError('è®¡ç®—è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + error.message);
            }
        }
        
        // æ‰§è¡Œå…·ä½“è®¡ç®—
        function performCalculation(t, mu_g, C_t) {
            const n = t.length;
            
            // æ­¥éª¤1ï¼šè®¡ç®—A = 1/(Î¼_g * C_t)
            const A = mu_g.map((mu, i) => 1 / (mu * C_t[i]));
            
            // æ­¥éª¤2ï¼šè®¡ç®—æ—¶é—´é—´éš”ï¼ˆå°æ—¶ï¼‰å¹¶è½¬æ¢ä¸ºç§’
            const dt_h = [];
            for (let i = 0; i < n - 1; i++) {
                dt_h.push(t[i + 1] - t[i]);
            }
            // æœ€åä¸€ä¸ªé—´éš”ä½¿ç”¨å‰ä¸€ä¸ªé—´éš”çš„å€¼
            dt_h.push(dt_h.length > 0 ? dt_h[dt_h.length - 1] : 0);
            
            const dt_sec = dt_h.map(dt => dt * 3600);
            
            // æ­¥éª¤3ï¼šè®¡ç®—Bå€¼
            const B = new Array(n).fill(0);
            B[0] = A[0] / 2;  // ç¬¬ä¸€ä¸ªBå€¼ï¼šA(1)/2
            
            for (let i = 1; i < n - 1; i++) {
                B[i] = (A[i - 1] + A[i]) / 2;  // ä¸­é—´Bå€¼ï¼šç›¸é‚»Açš„å¹³å‡å€¼
            }
            
            if (n > 1) {
                B[n - 1] = (A[n - 2] + A[n - 1]) / 2;  // æœ€åä¸€ä¸ªBå€¼
            }
            
            // æ­¥éª¤4ï¼šè®¡ç®—C'å€¼
            const C_prime = B.map((b, i) => b * dt_sec[i]);
            
            // æ­¥éª¤5ï¼šè®¡ç®—å‡æ—¶é—´t_a
            const t_a = new Array(n).fill(0);
            t_a[0] = C_prime[0];  // ç¬¬ä¸€ä¸ªå‡æ—¶é—´
            
            for (let i = 1; i < n; i++) {
                t_a[i] = t_a[i - 1] + C_prime[i];  // ç´¯åŠ è®¡ç®—
            }
            
            // æ•´ç†ç»“æœ
            const results = [];
            for (let i = 0; i < n; i++) {
                results.push({
                    t: t[i],
                    dt_h: dt_h[i],
                    dt_sec: dt_sec[i],
                    A: A[i],
                    B: B[i],
                    C_prime: C_prime[i],
                    t_a: t_a[i]
                });
            }
            
            return {
                results,
                t,
                t_a
            };
        }
        
        // æ˜¾ç¤ºè®¡ç®—ç»“æœ
        function displayResults(results) {
            // éšè—é”™è¯¯ä¿¡æ¯å’Œæ— ç»“æœä¿¡æ¯
            errorMessage.style.display = 'none';
            noResultsMessage.style.display = 'none';
            // æ˜¾ç¤ºç»“æœå®¹å™¨
            resultsContainer.style.display = 'block';
            
            // æ¸…ç©ºè¡¨æ ¼
            resultsTableBody.innerHTML = '';
            
            // å¡«å……è¡¨æ ¼
            results.results.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap">${item.t.toFixed(4)}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${item.dt_h.toFixed(4)}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${Math.round(item.dt_sec)}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${item.A.toFixed(6)}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${item.B.toFixed(6)}</td>
                    <td class="px-4 py-3 whitespace-nowrap">${item.C_prime.toFixed(4)}</td>
                    <td class="px-4 py-3 whitespace-nowrap font-medium text-primary">${item.t_a.toFixed(4)}</td>
                `;
                resultsTableBody.appendChild(row);
            });
            
            // åˆ›å»ºå›¾è¡¨ï¼ˆä½¿ç”¨åŸç”ŸSVGï¼‰
            createChart(results.t, results.t_a);
            
            // å¹³æ»‘æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // ä½¿ç”¨åŸç”ŸSVGåˆ›å»ºå‡æ—¶é—´ä¸å®é™…æ—¶é—´å…³ç³»å›¾ - æ¨ªçºµåæ ‡éƒ½ä»0å¼€å§‹
        function createChart(t, t_a) {
            // è·å–SVGå…ƒç´ å¹¶æ¸…ç©º
            const svg = document.getElementById('timeChart');
            svg.innerHTML = '';
            
            // è·å–SVGå°ºå¯¸
            const svgWidth = svg.clientWidth;
            const svgHeight = svg.clientHeight;
            
            // è¾¹è·
            const margin = { top: 30, right: 30, bottom: 40, left: 60 };
            const chartWidth = svgWidth - margin.left - margin.right;
            const chartHeight = svgHeight - margin.top - margin.bottom;
            
            // è®¡ç®—æ•°æ®èŒƒå›´ - ç¡®ä¿ä»0å¼€å§‹
            const tMin = 0; // Xè½´ä»0å¼€å§‹
            const tMax = Math.max(...t);
            const tRange = tMax - tMin;
            
            const t_aMin = 0; // Yè½´ä»0å¼€å§‹
            const t_aMax = Math.max(...t_a);
            const t_aRange = t_aMax - t_aMin;
            
            // æ·»åŠ 10%çš„é¢å¤–ç©ºé—´ï¼Œä½¿æ•°æ®ä¸ç´§è´´åæ ‡è½´
            const tPadding = tRange > 0 ? tRange * 0.1 : 1;
            const t_aPadding = t_aRange > 0 ? t_aRange * 0.1 : 1;
            
            // æ¯”ä¾‹å°ºå‡½æ•° - å°†æ•°æ®å€¼æ˜ å°„åˆ°å›¾è¡¨åæ ‡
            const xScale = (value) => {
                return margin.left + (value - tMin) / 
                    ((tMax + tPadding) - tMin) * chartWidth;
            };
            
            const yScale = (value) => {
                return margin.top + chartHeight - (value - t_aMin) / 
                    ((t_aMax + t_aPadding) - t_aMin) * chartHeight;
            };
            
            // åˆ›å»ºåæ ‡è½´
            // Xè½´
            const xAxis = document.createElementNS("http://www.w3.org/2000/svg", "line");
            xAxis.setAttribute('x1', margin.left);
            xAxis.setAttribute('y1', margin.top + chartHeight);
            xAxis.setAttribute('x2', margin.left + chartWidth);
            xAxis.setAttribute('y2', margin.top + chartHeight);
            xAxis.setAttribute('class', 'chart-axis');
            svg.appendChild(xAxis);
            
            // Yè½´
            const yAxis = document.createElementNS("http://www.w3.org/2000/svg", "line");
            yAxis.setAttribute('x1', margin.left);
            yAxis.setAttribute('y1', margin.top);
            yAxis.setAttribute('x2', margin.left);
            yAxis.setAttribute('y2', margin.top + chartHeight);
            yAxis.setAttribute('class', 'chart-axis');
            svg.appendChild(yAxis);
            
            // Xè½´æ ‡ç­¾
            const xLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            xLabel.setAttribute('x', margin.left + chartWidth / 2);
            xLabel.setAttribute('y', svgHeight - 10);
            xLabel.textContent = 'å®é™…æ—¶é—´ (å°æ—¶)';
            xLabel.setAttribute('class', 'chart-label');
            svg.appendChild(xLabel);
            
            // Yè½´æ ‡ç­¾
            const yLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
            yLabel.setAttribute('x', -svgHeight / 2);
            yLabel.setAttribute('y', 20);
            yLabel.setAttribute('transform', 'rotate(-90)');
            yLabel.textContent = 'å‡æ—¶é—´';
            yLabel.setAttribute('class', 'chart-label');
            svg.appendChild(yLabel);
            
            // ç»˜åˆ¶ç½‘æ ¼çº¿ - Xæ–¹å‘
            const xGridCount = 5;
            for (let i = 0; i <= xGridCount; i++) {
                const x = margin.left + (i / xGridCount) * chartWidth;
                const gridLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
                gridLine.setAttribute('x1', x);
                gridLine.setAttribute('y1', margin.top);
                gridLine.setAttribute('x2', x);
                gridLine.setAttribute('y2', margin.top + chartHeight);
                gridLine.setAttribute('class', 'chart-grid');
                svg.appendChild(gridLine);
                
                // ç½‘æ ¼æ ‡ç­¾
                const gridValue = tMin + (i / xGridCount) * (tMax + tPadding);
                const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
                label.setAttribute('x', x);
                label.setAttribute('y', margin.top + chartHeight + 20);
                label.textContent = gridValue.toFixed(2);
                label.setAttribute('class', 'chart-label');
                svg.appendChild(label);
            }
            
            // ç»˜åˆ¶ç½‘æ ¼çº¿ - Yæ–¹å‘
            const yGridCount = 5;
            for (let i = 0; i <= yGridCount; i++) {
                const y = margin.top + (i / yGridCount) * chartHeight;
                const gridLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
                gridLine.setAttribute('x1', margin.left);
                gridLine.setAttribute('y1', y);
                gridLine.setAttribute('x2', margin.left + chartWidth);
                gridLine.setAttribute('y2', y);
                gridLine.setAttribute('class', 'chart-grid');
                svg.appendChild(gridLine);
                
                // ç½‘æ ¼æ ‡ç­¾
                const gridValue = t_aMin + (yGridCount - i) / yGridCount * (t_aMax + t_aPadding);
                const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
                label.setAttribute('x', margin.left - 10);
                label.setAttribute('y', y + 4);
                label.setAttribute('text-anchor', 'end');
                label.textContent = gridValue.toFixed(2);
                label.setAttribute('class', 'chart-label');
                svg.appendChild(label);
            }
            
            // å‡†å¤‡è·¯å¾„æ•°æ®
            let pathData = `M ${xScale(t[0])} ${yScale(t_a[0])}`;
            let areaData = `M ${xScale(t[0])} ${yScale(t_a[0])}`;
            
            for (let i = 1; i < t.length; i++) {
                pathData += ` L ${xScale(t[i])} ${yScale(t_a[i])}`;
                areaData += ` L ${xScale(t[i])} ${yScale(t_a[i])}`;
            }
            
            // é—­åˆé¢ç§¯è·¯å¾„ - è¿æ¥åˆ°åº•éƒ¨Xè½´
            areaData += ` L ${xScale(t[t.length - 1])} ${yScale(t_aMin)}`;
            areaData += ` L ${xScale(t[0])} ${yScale(t_aMin)} Z`;
            
            // ç»˜åˆ¶é¢ç§¯
            const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
            area.setAttribute('d', areaData);
            area.setAttribute('class', 'chart-area');
            svg.appendChild(area);
            
            // ç»˜åˆ¶çº¿
            const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
            line.setAttribute('d', pathData);
            line.setAttribute('class', 'chart-line');
            svg.appendChild(line);
            
            // ç»˜åˆ¶æ•°æ®ç‚¹
            t.forEach((time, i) => {
                const point = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                point.setAttribute('cx', xScale(time));
                point.setAttribute('cy', yScale(t_a[i]));
                point.setAttribute('r', 4);
                point.setAttribute('class', 'chart-point');
                
                // æ·»åŠ æ‚¬åœæç¤º
                point.setAttribute('title', `æ—¶é—´: ${time.toFixed(4)}, å‡æ—¶é—´: ${t_a[i].toFixed(4)}`);
                svg.appendChild(point);
            });
            
            // åº”ç”¨æ·±è‰²æ¨¡å¼æ ·å¼
            if (document.body.classList.contains('dark-mode')) {
                document.querySelectorAll('.chart-grid').forEach(el => {
                    el.classList.add('dark-mode');
                });
                document.querySelectorAll('.chart-axis').forEach(el => {
                    el.classList.add('dark-mode');
                });
                document.querySelectorAll('.chart-label, .chart-title').forEach(el => {
                    el.classList.add('dark-mode');
                });
            } else {
                document.querySelectorAll('.chart-grid').forEach(el => {
                    el.classList.remove('dark-mode');
                });
                document.querySelectorAll('.chart-axis').forEach(el => {
                    el.classList.remove('dark-mode');
                });
                document.querySelectorAll('.chart-label, .chart-title').forEach(el => {
                    el.classList.remove('dark-mode');
                });
            }
        }
        
        // å“åº”çª—å£å¤§å°å˜åŒ–é‡ç»˜å›¾è¡¨
        window.addEventListener('resize', () => {
            if (calculationResults) {
                createChart(calculationResults.t, calculationResults.t_a);
            }
        });
        
        // æŸ¥è¯¢ä»»æ„æ—¶é—´ç‚¹çš„å‡æ—¶é—´
        function queryPseudoTime() {
            if (!calculationResults) return;
            
            // éšè—ä¹‹å‰çš„ç»“æœå’Œé”™è¯¯
            queryResult.style.display = 'none';
            queryError.style.display = 'none';
            
            // è·å–æŸ¥è¯¢æ—¶é—´
            const t_query = parseFloat(queryTimeInput.value);
            
            // éªŒè¯è¾“å…¥
            if (isNaN(t_query)) {
                showQueryError('è¯·è¾“å…¥æœ‰æ•ˆçš„æ—¶é—´å€¼');
                return;
            }
            
            const t = calculationResults.t;
            const t_a = calculationResults.t_a;
            
            // æ£€æŸ¥æ—¶é—´èŒƒå›´
            if (t_query < t[0]) {
                showQueryError(`æŸ¥è¯¢æ—¶é—´å¿…é¡»å¤§äºç­‰äº ${t[0].toFixed(4)} å°æ—¶`);
                return;
            }
            
            if (t_query > t[t.length - 1]) {
                showQueryError(`æŸ¥è¯¢æ—¶é—´å¿…é¡»å°äºç­‰äº ${t[t.length - 1].toFixed(4)} å°æ—¶`);
                return;
            }
            
            // æ‰¾åˆ°æŸ¥è¯¢æ—¶é—´æ‰€åœ¨çš„åŒºé—´
            let t_a_query;
            if (t_query === t[0]) {
                t_a_query = t_a[0];
            } else {
                // æŸ¥æ‰¾æŸ¥è¯¢æ—¶é—´æ‰€åœ¨çš„åŒºé—´ç´¢å¼•
                let idx = 0;
                for (let i = 0; i < t.length; i++) {
                    if (t[i] < t_query) {
                        idx = i;
                    } else {
                        break;
                    }
                }
                
                // è®¡ç®—è¯¥åŒºé—´å†…çš„æ—¶é—´æ¯”ä¾‹
                const t_start = t[idx];
                const t_end = t[idx + 1];
                const ratio = (t_query - t_start) / (t_end - t_start);
                
                // è®¡ç®—å¯¹åº”çš„å‡æ—¶é—´
                const t_a_start = t_a[idx];
                const t_a_end = t_a[idx + 1];
                t_a_query = t_a_start + ratio * (t_a_end - t_a_start);
            }
            
            // æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ
            queryResultText.textContent = `æ—¶é—´ ${t_query.toFixed(4)} å°æ—¶å¯¹åº”çš„å‡æ—¶é—´ä¸º: ${t_a_query.toFixed(4)}`;
            queryResult.style.display = 'block';
            
            // æ·»åŠ ç»“æœé«˜äº®åŠ¨ç”»
            queryResult.classList.add('animate-pulse');
            setTimeout(() => {
                queryResult.classList.remove('animate-pulse');
            }, 1000);
        }
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            errorText.textContent = message;
            errorMessage.style.display = 'block';
            resultsContainer.style.display = 'none';
            noResultsMessage.style.display = 'none';
            
            // ç¦ç”¨æŸ¥è¯¢åŠŸèƒ½
            queryTimeInput.disabled = true;
            queryButton.disabled = true;
        }
        
        // æ˜¾ç¤ºæŸ¥è¯¢é”™è¯¯
        function showQueryError(message) {
            queryErrorText.textContent = message;
            queryError.style.display = 'block';
        }
        
        // é¡µé¢æ»šåŠ¨æ•ˆæœ - å¯¼èˆªæ æ ·å¼å˜åŒ–
        window.addEventListener('scroll', () => {
            if (window.scrollY > 10) {
                header.style.padding = '0.5rem 0';
            } else {
                header.style.padding = '1rem 0';
            }
        });
    </script>
</body>
</html>
